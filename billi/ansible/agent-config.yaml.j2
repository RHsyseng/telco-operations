apiVersion: v1alpha1
hosts:
{% for host in hosts %}
- hostname: {{ host['name']|default(cluster + "-" + loop.index0|string) }}
  interfaces:
  - macAddress: {{ host['mac'] }}
    name: {{ host['nic']|default('ens3') }}
  networkConfig:
    dns-resolver:
      config:
        server:
{% for ns in dns_resolver %}
        - {{ ns }}
{% endfor %}
    interfaces:
    - ethernet:
        auto-negotiation: true
        duplex: full
        speed: 1000
{{ '      ipv6' if ':' in host['ip'] else '      ipv4' }}:
        address:
        - ip: {{ host['ip'] }}
          prefix-length: {{ prefix }}
        enabled: true
      mac-address: {{ host['mac'] }}
      mtu: 1500
      name: {{ host['nic']|default('ens3') }}
      state: up
      type: ethernet
    routes:
      config:
{% if ':' not in host['ip'] %}
      - destination: {{ machine_cidr }}
        next-hop-address: {{ gateway }}
        next-hop-interface: {{ host['nic']|default('ens3') }}
{% endif %}
      - destination: {{ "::/0" if ':' in host['ip'] else "0.0.0.0/0" }}
        next-hop-address: {{ gateway }}
        next-hop-interface: {{ host['nic']|default('ens3') }}
{% if ':' not in host['ip'] %}
        table-id: 254
{% endif %}
        enabled: true
{% endfor %}
kind: AgentConfig
metadata:
  name: billi
rendezvousIP: {{ rendezvous_ip|default(hosts[0]['ip']) }}
